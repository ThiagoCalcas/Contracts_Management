SELECT TBL_Contratos.UF, TBL_Contratos.NomeContrato, QRY__FRM_ContratosVisaoGeral.NomeEGTTV, TBL_Contratos.Tipo, Format(QRY__FRM_ContratosVisaoGeral.SIGES,'000000\/0000') AS NumeroContrato, QRY__FRM_ContratosVisaoGeral.SiglaGILOG, QRY__FRM_ContratosVisaoGeral.RegiaoGILOG, Format(IIf([MesesVigencia8]=0,IIf([MesesVigencia7]=0,IIf([MesesVigencia6]=0,IIf([MesesVigencia5]=0,IIf([MesesVigencia4]=0,IIf([MesesVigencia3]=0,IIf([MesesVigencia2]=0,IIf([MesesVigencia1]=0,[Utilizacao0],[Utilizacao1]),IIf([InicioProrrogacao2]<=Now(),[Utilizacao2],[Utilizacao1])),IIf([InicioProrrogacao3]<=Now(),[Utilizacao3],[Utilizacao2])),IIf([InicioProrrogacao4]<=Now(),[Utilizacao4],[Utilizacao3])),IIf([InicioProrrogacao5]<=Now(),[Utilizacao5],[Utilizacao4])),IIf([InicioProrrogacao6]<=Now(),[Utilizacao6],[Utilizacao5])),IIf([InicioProrrogacao7]<=Now(),[Utilizacao7],[Utilizacao6])),IIf([InicioProrrogacao8]<=Now(),[Utilizacao8],[Utilizacao7])),'Percent') AS [% Adit], Format(IIf([MesesVigencia8]=0,IIf([MesesVigencia7]=0,IIf([MesesVigencia6]=0,IIf([MesesVigencia5]=0,IIf([MesesVigencia4]=0,IIf([MesesVigencia3]=0,IIf([MesesVigencia2]=0,IIf([MesesVigencia1]=0,[UtilizadoMensal0],[UtilizadoMensal1]),IIf([InicioProrrogacao2]<=Now(),[UtilizadoMensal2],[UtilizadoMensal1])),IIf([InicioProrrogacao3]<=Now(),[UtilizadoMensal3],[UtilizadoMensal2])),IIf([InicioProrrogacao4]<=Now(),[UtilizadoMensal4],[UtilizadoMensal3])),IIf([InicioProrrogacao5]<=Now(),[UtilizadoMensal5],[UtilizadoMensal4])),IIf([InicioProrrogacao6]<=Now(),[UtilizadoMensal6],[UtilizadoMensal5])),IIf([InicioProrrogacao7]<=Now(),[UtilizadoMensal7],[UtilizadoMensal6])),IIf([InicioProrrogacao8]<=Now(),[UtilizadoMensal8],[UtilizadoMensal7])),'Percent') AS [% Adit Mensal], Format(IIf([MesesVigencia8]=0,IIf([MesesVigencia7]=0,IIf([MesesVigencia6]=0,IIf([MesesVigencia5]=0,IIf([MesesVigencia4]=0,IIf([MesesVigencia3]=0,IIf([MesesVigencia2]=0,IIf([MesesVigencia1]=0,[Estimativa2Meses0],[Estimativa2Meses1]),IIf([InicioProrrogacao2]<=Now(),[Estimativa2Meses2],[Estimativa2Meses1])),IIf([InicioProrrogacao3]<=Now(),[Estimativa2Meses3],[Estimativa2Meses2])),IIf([InicioProrrogacao4]<=Now(),[Estimativa2Meses4],[Estimativa2Meses3])),IIf([InicioProrrogacao5]<=Now(),[Estimativa2Meses5],[Estimativa2Meses4])),IIf([InicioProrrogacao6]<=Now(),[Estimativa2Meses6],[Estimativa2Meses5])),IIf([InicioProrrogacao7]<=Now(),[Estimativa2Meses7],[Estimativa2Meses6])),IIf([InicioProrrogacao8]<=Now(),[Estimativa2Meses8],[Estimativa2Meses7])),'Fixed') AS Estimativa2Meses, Format(IIf([MesesVigencia8]=0,IIf([MesesVigencia7]=0,IIf([MesesVigencia6]=0,IIf([MesesVigencia5]=0,IIf([MesesVigencia4]=0,IIf([MesesVigencia3]=0,IIf([MesesVigencia2]=0,IIf([MesesVigencia1]=0,[EstimativaDuracaoMedia0],[EstimativaDuracaoMedia1]),IIf([InicioProrrogacao2]<=Now(),[EstimativaDuracaoMedia2],[EstimativaDuracaoMedia1])),IIf([InicioProrrogacao3]<=Now(),[EstimativaDuracaoMedia3],[EstimativaDuracaoMedia2])),IIf([InicioProrrogacao4]<=Now(),[EstimativaDuracaoMedia4],[EstimativaDuracaoMedia3])),IIf([InicioProrrogacao5]<=Now(),[EstimativaDuracaoMedia5],[EstimativaDuracaoMedia4])),IIf([InicioProrrogacao6]<=Now(),[EstimativaDuracaoMedia6],[EstimativaDuracaoMedia5])),IIf([InicioProrrogacao7]<=Now(),[EstimativaDuracaoMedia7],[EstimativaDuracaoMedia6])),IIf([InicioProrrogacao8]<=Now(),[EstimativaDuracaoMedia8],[EstimativaDuracaoMedia7])),'Fixed') AS EstimativaDuracaoMedia, Format(IIf([MesesVigencia8]=0,IIf([MesesVigencia7]=0,IIf([MesesVigencia6]=0,IIf([MesesVigencia5]=0,IIf([MesesVigencia4]=0,IIf([MesesVigencia3]=0,IIf([MesesVigencia2]=0,IIf([MesesVigencia1]=0,[Estimativa5Meses0],[Estimativa5Meses1]),IIf([InicioProrrogacao2]<=Now(),[Estimativa5Meses2],[Estimativa5Meses1])),IIf([InicioProrrogacao3]<=Now(),[Estimativa5Meses3],[Estimativa5Meses2])),IIf([InicioProrrogacao4]<=Now(),[Estimativa5Meses4],[Estimativa5Meses3])),IIf([InicioProrrogacao5]<=Now(),[Estimativa5Meses5],[Estimativa5Meses4])),IIf([InicioProrrogacao6]<=Now(),[Estimativa5Meses6],[Estimativa5Meses5])),IIf([InicioProrrogacao7]<=Now(),[Estimativa5Meses7],[Estimativa5Meses6])),IIf([InicioProrrogacao8]<=Now(),[Estimativa5Meses8],[Estimativa5Meses7])),'Fixed') AS Estimativa5Meses, Format(IIf([MesesVigencia8]=0,IIf([MesesVigencia7]=0,IIf([MesesVigencia6]=0,IIf([MesesVigencia5]=0,IIf([MesesVigencia4]=0,IIf([MesesVigencia3]=0,IIf([MesesVigencia2]=0,IIf([MesesVigencia1]=0,[Estimativa5-1Meses0],[Estimativa5-1Meses1]),IIf([InicioProrrogacao2]<=Now(),[Estimativa5-1Meses2],[Estimativa5-1Meses1])),IIf([InicioProrrogacao3]<=Now(),[Estimativa5-1Meses3],[Estimativa5-1Meses2])),IIf([InicioProrrogacao4]<=Now(),[Estimativa5-1Meses4],[Estimativa5-1Meses3])),IIf([InicioProrrogacao5]<=Now(),[Estimativa5-1Meses5],[Estimativa5-1Meses4])),IIf([InicioProrrogacao6]<=Now(),[Estimativa5-1Meses6],[Estimativa5-1Meses5])),IIf([InicioProrrogacao7]<=Now(),[Estimativa5-1Meses7],[Estimativa5-1Meses6])),IIf([InicioProrrogacao8]<=Now(),[Estimativa5-1Meses8],[Estimativa5-1Meses7])),'Fixed') AS [Estimativa5-1Meses], IIf([MesesVigencia8]=0,IIf([MesesVigencia7]=0,IIf([MesesVigencia6]=0,IIf([MesesVigencia5]=0,IIf([MesesVigencia4]=0,IIf([MesesVigencia3]=0,IIf([MesesVigencia2]=0,IIf([MesesVigencia1]=0,[PgtosRestantesVig0],[PgtosRestantesVig1]),IIf([InicioProrrogacao2]<=Now(),[PgtosRestantesVig2],[PgtosRestantesVig1])),IIf([InicioProrrogacao3]<=Now(),[PgtosRestantesVig3],[PgtosRestantesVig2])),IIf([InicioProrrogacao4]<=Now(),[PgtosRestantesVig4],[PgtosRestantesVig3])),IIf([InicioProrrogacao5]<=Now(),[PgtosRestantesVig5],[PgtosRestantesVig4])),IIf([InicioProrrogacao6]<=Now(),[PgtosRestantesVig6],[PgtosRestantesVig5])),IIf([InicioProrrogacao7]<=Now(),[PgtosRestantesVig7],[PgtosRestantesVig6])),IIf([InicioProrrogacao8]<=Now(),[PgtosRestantesVig8],[PgtosRestantesVig7])) AS MesesRestantes, QRY_DuracaoContrato.DataFim, int(IIf([MesesVigencia8]=0,IIf([MesesVigencia7]=0,IIf([MesesVigencia6]=0,IIf([MesesVigencia5]=0,IIf([MesesVigencia4]=0,IIf([MesesVigencia3]=0,IIf([MesesVigencia2]=0,IIf([MesesVigencia1]=0,[MesUltimoPgto0],IIf(int([MesUltimoPgto1])=0,[MesUltimoPgto0],[MesUltimoPgto1])),IIf([InicioProrrogacao2]<=Now(),IIf(int([MesUltimoPgto2])=0,[MesUltimoPgto1],[MesUltimoPgto2]),IIf(int([MesUltimoPgto1])=0,[MesUltimoPgto0],[MesUltimoPgto1]))),IIf([InicioProrrogacao3]<=Now(),IIf(int([MesUltimoPgto3])=0,[MesUltimoPgto2],[MesUltimoPgto3]),IIf(int([MesUltimoPgto2])=0,[MesUltimoPgto1],[MesUltimoPgto2]))),IIf([InicioProrrogacao4]<=Now(),IIf(int([MesUltimoPgto4])=0,[MesUltimoPgto3],[MesUltimoPgto4]),IIf(int([MesUltimoPgto3])=0,[MesUltimoPgto2],[MesUltimoPgto3]))),IIf([InicioProrrogacao5]<=Now(),IIf(int([MesUltimoPgto5])=0,[MesUltimoPgto4],[MesUltimoPgto5]),IIf(int([MesUltimoPgto4])=0,[MesUltimoPgto3],[MesUltimoPgto4]))),IIf([InicioProrrogacao6]<=Now(),IIf(int([MesUltimoPgto6])=0,[MesUltimoPgto5],[MesUltimoPgto6]),IIf(int([MesUltimoPgto5])=0,[MesUltimoPgto4],[MesUltimoPgto5]))),IIf([InicioProrrogacao7]<=Now(),IIf(int([MesUltimoPgto7])=0,[MesUltimoPgto6],[MesUltimoPgto7]),IIf(int([MesUltimoPgto6])=0,[MesUltimoPgto5],[MesUltimoPgto6]))),IIf([InicioProrrogacao8]<=Now(),IIf(int([MesUltimoPgto8])=0,[MesUltimoPgto7],[MesUltimoPgto8]),IIf(int([MesUltimoPgto7])=0,[MesUltimoPgto6],[MesUltimoPgto7])))) AS MesUltimoPgto, int(IIf([MesesVigencia8]=0,IIf([MesesVigencia7]=0,IIf([MesesVigencia6]=0,IIf([MesesVigencia5]=0,IIf([MesesVigencia4]=0,IIf([MesesVigencia3]=0,IIf([MesesVigencia2]=0,IIf([MesesVigencia1]=0,[AnoUltimoPgto0],IIf(int([AnoUltimoPgto1])=0,[AnoUltimoPgto0],[AnoUltimoPgto1])),IIf([InicioProrrogacao2]<=Now(),IIf(int([AnoUltimoPgto2])=0,[AnoUltimoPgto1],[AnoUltimoPgto2]),IIf(int([AnoUltimoPgto1])=0,[AnoUltimoPgto0],[AnoUltimoPgto1]))),IIf([InicioProrrogacao3]<=Now(),IIf(int([AnoUltimoPgto3])=0,[AnoUltimoPgto2],[AnoUltimoPgto3]),IIf(int([AnoUltimoPgto2])=0,[AnoUltimoPgto1],[AnoUltimoPgto2]))),IIf([InicioProrrogacao4]<=Now(),IIf(int([AnoUltimoPgto4])=0,[AnoUltimoPgto3],[AnoUltimoPgto4]),IIf(int([AnoUltimoPgto3])=0,[AnoUltimoPgto2],[AnoUltimoPgto3]))),IIf([InicioProrrogacao5]<=Now(),IIf(int([AnoUltimoPgto5])=0,[AnoUltimoPgto4],[AnoUltimoPgto5]),IIf(int([AnoUltimoPgto4])=0,[AnoUltimoPgto3],[AnoUltimoPgto4]))),IIf([InicioProrrogacao6]<=Now(),IIf(int([AnoUltimoPgto6])=0,[AnoUltimoPgto5],[AnoUltimoPgto6]),IIf(int([AnoUltimoPgto5])=0,[AnoUltimoPgto4],[AnoUltimoPgto5]))),IIf([InicioProrrogacao7]<=Now(),IIf(int([AnoUltimoPgto7])=0,[AnoUltimoPgto6],[AnoUltimoPgto7]),IIf(int([AnoUltimoPgto6])=0,[AnoUltimoPgto5],[AnoUltimoPgto6]))),IIf([InicioProrrogacao8]<=Now(),IIf(int([AnoUltimoPgto8])=0,[AnoUltimoPgto7],[AnoUltimoPgto8]),IIf(int([AnoUltimoPgto7])=0,[AnoUltimoPgto6],[AnoUltimoPgto7])))) AS AnoUltimoPgto, iif(int([MesUltimoPgto])=0,0,int([Estimativa5Meses]+1+int([MesUltimoPgto])-(int(([Estimativa5Meses]+int([MesUltimoPgto]))/12))*12)) AS [MesArt59 5m], iif(int([MesUltimoPgto])=0,0,int(([Estimativa5Meses]+int([MesUltimoPgto]))/12)+[AnoUltimoPgto]) AS [AnoArt59 5m], QRY_DuracaoContrato.Meses, QRY_Licitacoes.SICLG, QRY_Licitacoes.InclusaoSICLG, QRY__FRM_ContratosVisaoGeral.Observacao, QRY__FRM_ContratosVisaoGeral.Obs_Art59
FROM (QRY__FRM_ContratosVisaoGeral INNER JOIN QRY_DuracaoContrato ON QRY__FRM_ContratosVisaoGeral.CodContratos = QRY_DuracaoContrato.CodContratos) INNER JOIN ((SELECT TBL_Licitacoes.CodContratos, Min(TBL_Licitacoes.SICLG) AS SICLG, Min(TBL_Licitacoes.InclusaoSICLG) AS InclusaoSICLG, TBL_Contratos.Situacao FROM TBL_Licitacoes INNER JOIN TBL_Contratos ON TBL_Licitacoes.CodContratos = TBL_Contratos.CodContratos GROUP BY TBL_Licitacoes.CodContratos, TBL_Contratos.Situacao HAVING (((TBL_Contratos.Situacao)='Ativo')))  AS QRY_Licitacoes RIGHT JOIN TBL_Contratos ON QRY_Licitacoes.CodContratos = TBL_Contratos.CodContratos) ON QRY__FRM_ContratosVisaoGeral.CodContratos = TBL_Contratos.CodContratos
WHERE (((QRY__FRM_ContratosVisaoGeral.Situacao)='Ativo'))
ORDER BY IIf([Estimativa5Meses8]>0,[Estimativa5Meses8],IIf([Estimativa5Meses7]>0,[Estimativa5Meses7], IIf([Estimativa5Meses6]>0,[Estimativa5Meses6],IIf([Estimativa5Meses5]>0,[Estimativa5Meses5], IIf([Estimativa5Meses4]>0,[Estimativa5Meses4],IIf([Estimativa5Meses3]>0,[Estimativa5Meses3], IIf([Estimativa5Meses3]>0,[Estimativa5Meses3],IIf([Estimativa5Meses2]>0,[Estimativa5Meses2], IIf([Estimativa5Meses1]>0,[Estimativa5Meses1],[Estimativa5Meses0])))))))));
